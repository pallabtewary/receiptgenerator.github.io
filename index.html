<!DOCTYPE html>
<html>
<head>
  <title>Receipt Generator</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- pdfmake -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>
  <style>
    @media (max-width: 768px) {
      .receipt-table {
        font-size: 14px;
      }
      .receipt-title {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <div class="container mt-5">
    <h1 class="mb-4">Receipt Generator</h1>
    <div class="row">
      <div class="col-md-6">
        <form id="expenseForm">
          <div class="form-group">
            <label for="date">Date:</label>
            <input type="date" class="form-control" id="date">
          </div>
          <div class="form-group">
            <label for="description">Description:</label>
            <input type="text" class="form-control" id="description" required>
          </div>
          <div class="form-group">
            <label for="amount">Amount:</label>
            <input type="number" class="form-control" id="amount" required>
          </div>
          <button type="button" class="btn btn-primary mr-2" onclick="addExpense()">Add Expense</button>
          <button type="button" class="btn btn-success" onclick="generateReceipt()">Generate Receipt</button>
        </form>
      </div>
      <div class="col-md-6">
        <div id="receiptContainer">
          <h4 class="receipt-title">Receipt Preview:</h4>
          <div class="table-responsive">
            <table class="table table-bordered receipt-table">
              <thead>
                <tr>
                  <th>Sl No</th>
                  <th>Date</th>
                  <th>Description</th>
                  <th>Amount</th>
                </tr>
              </thead>
              <tbody>
                <!-- The table content will be dynamically updated -->
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="3" class="text-right font-weight-bold">Total Amount:</td>
                  <td>₹0.00</td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let expenses = [];
    let totalAmount = 0;

    function addExpense() {
      const date = document.getElementById("date").value;
      const description = document.getElementById("description").value;
      const amount = parseFloat(document.getElementById("amount").value);

      const formattedDate = date ? new Date(date).toLocaleDateString() : "NA";

      if (description && !isNaN(amount)) {
        expenses.push({ date: formattedDate, description, amount });
        totalAmount += amount;
        document.getElementById("expenseForm").reset();
        updateReceiptContainer();
      }
    }

    function updateReceiptContainer() {
      let html = "";
      expenses.forEach((expense, index) => {
        html += `<tr>
          <td>${index + 1}</td>
          <td style="color: ${expense.date === 'NA' ? 'gray' : 'black'}">${expense.date}</td>
          <td>${expense.description}</td>
          <td>₹${expense.amount.toFixed(2)}</td>
        </tr>`;
      });

      document.getElementById("receiptContainer").querySelector("tbody").innerHTML = html;
      document.getElementById("receiptContainer").querySelector("tfoot td:last-child").textContent = `₹${totalAmount.toFixed(2)}`;
    }

    function generateReceipt() {
      if (expenses.length === 0) {
        alert("Add some expenses before generating the receipt.");
        return;
      }

      const customerName = prompt("Please enter the customer name:");
      if (!customerName) return;

      const monthName = prompt("Please enter the month name:");
      if (!monthName) return;
      const spaces = " ".repeat(40 - monthName.length);

      const docDefinition = {
        pageSize: 'A4',
        pageOrientation: 'portrait',
        pageMargins: [40, 40, 40, 60],

        content: [
          { text: `${spaces}${monthName} - Expenses`, fontSize: 24, color: '#007BFF', alignment: 'right' },
          { text: `Customer Name: ${customerName}`, fontSize: 16, margin: [0, 0, 0, 10] },
          {
            style: 'receiptTable',
            table: {
              headerRows: 1,
              widths: ['auto', 'auto', '*', 'auto'],
              body: [
                [{ text: 'Sl No', style: 'tableHeader' }, { text: 'Date', style: 'tableHeader' }, { text: 'Description', style: 'tableHeader' }, { text: 'Amount', style: 'tableHeader' }],
                ...expenses.map((expense, index) => [index + 1, { text: expense.date, color: expense.date === 'NA' ? 'gray' : 'black' }, expense.description, { text: `₹${expense.amount.toFixed(2)}`, alignment: 'right' }])
              ]
            }
          },
          { text: `Total Amount: ₹${totalAmount.toFixed(2)}`, fontSize: 16, bold: true, margin: [0, 10, 0, 0], alignment: 'right' }
        ],

        styles: {
          receiptTable: {
            margin: [0, 10, 0, 15],
            fontSize: 12
          },
          tableHeader: {
            fillColor: '#f2f2f2',
            alignment: 'center',
            bold: true,
          }
        }
      };

      pdfMake.createPdf(docDefinition).download(`${customerName}_receipt.pdf`);
    }
  </script>
</body>
</html>
